/*! jquery wheater 3.0 | copyright 2013 | http://julying.com/lab/weather/ || 王子墨，QQ:316970111 */
;(function(e){var b={fps:40,duration:5000,creatDropTime:400,sky:"sunshine",weatherData:{},move:true,drag:true,autoDrop:false,weatherStates:{sunshine:{length:1},cloudy:{length:1},overcast:{length:2},rainy:{length:2,drop:[{time:300},{time:300}]},sleet:{length:2,drop:[{time:300},{time:800}]},snow:{length:2,drop:[{time:800},{time:800}]}}};e.fn.weather=function(g){g=e.extend({},b,g);g.sky=g.sky||b.sky;g.drag=!!g.drag;g.move=!!g.move;g.autoDrop=!!g.autoDrop;var h;this.each(function(){h=new f(e(this),g);h.init(g.config)});return h.$weatherArea};function f(g,h){this.$element=g;this.$weatherArea=null;this.$weather=null;this.opts=h;this.sky=h.sky;this.skyState=h.weatherStates[h.sky]}f.prototype={constructor:f,version:"3.0",init:function(h){var m=this.opts.weatherData||{},k=[],l=(this.skyState||"").length,g='<div class="weather-info"><h2>{#city#}<span>{#date#}</span></h2><div class="weather-show"><div class="day_weather"><span class="weather">{#day#}:{#day_weather#}</span>/<span class="temp">{#day_temp#}{#temp#}</span></div><div class="night_weather"><span class="weather">{#night#}:{#night_weather#}</span>/<span class="temp">{#night_temp#}{#temp#}</span></div></div></div>',j=0;for(;j<l;j++){k.push('<div class="julying-weather"><div class="'+this.opts.sky+" sky sky-"+j+'"><div class="child-'+j+' child">');if(m.city){k.push(a(g,{"{#city#}":m.city,"{#date#}":m.date,"{#day#}":h.lang.day,"{#day_weather#}":m.day_weather,"{#day_temp#}":m.day_temp,"{#temp#}":h.lang.temp,"{#day_wind#}":m.day_wind,"{#night_weather#}":m.night_weather,"{#night#}":h.lang.night,"{#night_temp#}":m.night_temp,"{#wangzimo#}":h.lang.wangzimo}))}k.push("</div></div></div>")}this.$element.append(k.join(""));k=null;this.$weatherArea=this.$element.find("div.julying-weather");this.$weather=this.$element.find(".sky");this.moveIcon();this.creatDrop();if(this.opts.drag){this.dragWeather()}return this},moveIcon:function(){var h=[];_self=this;this.$weather.each(function(k){var l=e(this);var j=l.find(".weather-info");l.click(function(){if(!l.hasClass("weather-is-move")){j.show(300)}return false}).show();e(document).click(function(){j.hide(300)});if(!_self.opts.move){return _self}l.css({left:d(0,l.parent().width()*0.8)}).show();l.hover(function(){l.stop();if(h[k]){clearTimeout(h[k])}},function(){if(h[k]){clearTimeout(h[k])}h[k]=setTimeout(function(){g(l,k)},d(200,1000));j.hide(300)});g(l,k);e(window).resize(function(){clearTimeout(h[k]||{});l.stop().animate({left:d(0,l.parent().width()*0.5)},300,function(){g(l,k)})});return _self});function g(u,t){var l=arguments.callee,v=u.parent().width(),j=0,s=0,k=u.width()||160,r=v-k,q=_self.opts.duration,p=d(0,r),m=_self.opts.fps,o=Math.abs(parseInt(u.css("left"))-p)*d(m*0.8,m*1.2)||5000,n=d(q-q*0.5,q+q*0.5);u.animate({left:p},o,"linear",function(){h[t]=setTimeout(function(){l(u,t)},d(50,1000))})}},creatDrop:function(){var g=this;this.$weather.each(function(h){if(!g.skyState.drop||!g.skyState.drop.length){return false}var l=e(this),k=l.find(".child"),j=null;if(g.opts.autoDrop){setInterval(function(){g.drop(k)},g.opts.creatDropTime)}else{l.hover(function(){clearInterval(j||{});j=setInterval(function(){g.drop(k)},g.opts.creatDropTime)},function(){clearInterval(j||{})})}})},drop:function(g){this.makeDrop(g);g.find("div[name=init]").each(function(){var j=e(this),i=parseInt(j.css("top"))||0,h=parseInt(j.attr("data-fly-time"))||200;j.attr({name:"run"});setTimeout(function(){j.css({display:"block",top:d(i-10,i+10)}).animate({top:g.height()+parseInt(j.attr("data-end")),opacity:0},h,function(){j.remove()})},d(0,1000))})},makeDrop:function(g){var p=g.width(),q=g.height(),h=0,j=0,n=d(0,(this.skyState.drop.length||1)-1),m=this.skyState.drop[n].time||300,l="",k=0,o=d(2,6);m=d(m*0.5,m*2);for(;k<=o;k++){h=d(0,p*0.9);j=d(q*0.5,q*2);l=l+'<div name="init" data-end="'+j+'" class="drop drop-'+n+'" data-fly-time="'+m+'" style="left:'+h+'px;"><i></i></div>'}g.append(l)},dragWeather:function(){this.$weather.each(function(g){c(e(this),g)})}};function d(h,j){var g=j-h;var i=h+Math.round(Math.random()*g);return parseInt(i)}function a(h,i){for(var g in i){h=h.split(g).join(i[g])}return h}function c(k){var i=false,h=0,g=0;k.mousedown(function(l){i=true;h=l.pageX||0;g=l.pageY||0;h=h-parseInt(k.css("left"));g=g-parseInt(k.css("top"));k.addClass("weather-is-move");e(document).bind("mousemove.weather",function(m){j(m)})}).mouseup(function(){i=false;e(document).unbind("mousemove.weather",j());k.removeClass("weather-is-move")});function j(m){if(!i){return}var l=m.pageX-h,n=m.pageY-g;k.css({left:l,top:n})}return k}})(jQuery);